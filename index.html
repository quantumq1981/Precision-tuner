<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bird Blues Bebop Trainer</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #121212;
      color: #eee;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #ff9800;
    }

    .main-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .instructions {
      max-width: 800px;
      margin: 0 auto 20px auto;
      font-size: 14px;
      text-align: center;
      color: #ccc;
    }

    .chart {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin: 20px auto;
    }

    .bar {
      background: #1e1e1e;
      border: 1px solid #444;
      padding: 12px;
      min-height: 130px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      transition: all 0.3s;
    }

    .bar:hover {
      background: #2e2e2e;
    }

    .bar.active {
      background: #2e4e2e;
      border-color: #66bb6a;
    }

    .chord {
      font-size: 20px;
      font-weight: bold;
      color: #ffffff;
    }

    .roman {
      font-size: 14px;
      color: #aaa;
    }

    .scale {
      font-size: 14px;
      color: #66bb6a;
      margin-top: 5px;
    }

    .notes {
      font-size: 13px;
      color: #90caf9;
      margin-top: 4px;
    }

    .fretboard-section {
      background: #1a1a1a;
      border: 2px solid #444;
      border-radius: 8px;
      padding: 20px;
      margin: 30px auto;
    }

    .fretboard-title {
      color: #ff9800;
      font-size: 18px;
      margin-bottom: 15px;
      text-align: center;
    }

    .fretboard {
      display: flex;
      flex-direction: column;
      gap: 3px;
      background: #2a2a2a;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }

    .string {
      display: flex;
      gap: 2px;
      align-items: center;
    }

    .string-label {
      width: 30px;
      text-align: right;
      color: #888;
      font-size: 14px;
      font-weight: bold;
    }

    .fret {
      width: 50px;
      height: 35px;
      background: #3a3a3a;
      border: 1px solid #555;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #666;
      position: relative;
    }

    .fret.highlighted {
      background: #66bb6a;
      color: #000;
      font-weight: bold;
      border-color: #88dd88;
    }

    .fret.root {
      background: #ff9800;
      color: #000;
      font-weight: bold;
      border-color: #ffb733;
    }

    .fret.sub {
      background: #42a5f5;
      color: #000;
      border-color: #64b5f6;
    }

    .fret.dom {
      background: #ef5350;
      color: #000;
      border-color: #e57373;
    }

    .fret.alt {
      background: #ffee58;
      color: #000;
      border-color: #fff176;
    }

    .fret.highlighted,
    .fret.sub,
    .fret.dom,
    .fret.alt {
      font-size: 10px;
      line-height: 1.1;
      white-space: pre;
    }

    .fret-markers {
      display: flex;
      gap: 2px;
      margin-top: 5px;
      padding-left: 30px;
    }

    .fret-marker {
      width: 50px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #666;
    }

    .fret-marker.marked {
      color: #ff9800;
    }

    .scale-library {
      background: #1a1a1a;
      border: 2px solid #444;
      border-radius: 8px;
      padding: 20px;
      margin: 30px auto;
    }

    .scale-library-title {
      color: #ff9800;
      font-size: 18px;
      margin-bottom: 15px;
      text-align: center;
    }

    .scale-categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .scale-category {
      background: #2a2a2a;
      padding: 15px;
      border-radius: 4px;
    }

    .category-title {
      color: #66bb6a;
      font-size: 16px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .scale-item {
      padding: 8px;
      margin: 5px 0;
      background: #1e1e1e;
      border: 1px solid #444;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .scale-item:hover {
      background: #2e2e2e;
      border-color: #66bb6a;
    }

    .scale-name {
      font-weight: bold;
      color: #fff;
      margin-bottom: 3px;
    }

    .scale-notes {
      font-size: 12px;
      color: #90caf9;
    }

    .controls {
      text-align: center;
      margin: 20px 0;
    }

    .btn {
      background: #ff9800;
      color: #000;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      transition: background 0.2s;
    }

    .btn:hover {
      background: #ffb733;
    }

    @media (max-width: 900px) {
      .chart {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .chart {
        grid-template-columns: 1fr;
      }

      .fret {
        width: 40px;
        height: 32px;
      }

      .fret-marker,
      .string-label {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <h1>ðŸŽ¶ Bird Blues Bebop Trainer</h1>
    <p class="instructions">
      Click on any chord to hear the scale and see it on the fretboard. <br />
      ðŸŸ§ Orange = Root (I) | ðŸŸ¦ Blue = Subdominant (II, IV) | ðŸŸ¥ Red = Dominant (V, VII) | ðŸŸ¨ Yellow = Mediant/Other (III, VI)
    </p>

    <div class="chart" id="chart"></div>

    <div class="fretboard-section">
      <div class="fretboard-title" id="fretboard-title">Select a chord to see the scale on the fretboard</div>
      <div class="controls">
        <button class="btn" id="clearFretboardBtn">Clear Fretboard</button>
      </div>
      <div class="fretboard" id="fretboard"></div>
      <div class="fret-markers" id="fret-markers"></div>
    </div>

    <div class="scale-library">
      <div class="scale-library-title">Scale Library (Click to visualize)</div>
      <div class="scale-categories" id="scale-library"></div>
    </div>
  </div>

  <script>
    const ctx = new (window.AudioContext || window.webkitAudioContext)();

    const NOTE_OFFSETS = {
      C: 0,
      D: 2,
      E: 4,
      F: 5,
      G: 7,
      A: 9,
      B: 11,
    };

    const SEMITONE_TO_NOTE = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

    const chromaticScale = [...SEMITONE_TO_NOTE];

    const stringNotes = ['E', 'B', 'G', 'D', 'A', 'E'];
    const fretCount = 15;

    function sanitizeAccidentals(note) {
      if (!note) return '';
      return note.replace(/â™­/g, 'b').replace(/â™¯/g, '#');
    }

    function parseNote(note) {
      if (!note) return null;
      const sanitized = sanitizeAccidentals(note);
      const match = sanitized.match(/^([A-Ga-g])([b#]*)$/);
      if (!match) return null;

      const letter = match[1].toUpperCase();
      let semitone = NOTE_OFFSETS[letter];

      for (const accidental of match[2]) {
        semitone += accidental === '#' ? 1 : -1;
      }

      semitone = ((semitone % 12) + 12) % 12;
      return { letter, semitone, sanitized };
    }

    function normalizeNote(note) {
      const parsed = parseNote(note);
      return parsed ? SEMITONE_TO_NOTE[parsed.semitone] : sanitizeAccidentals(note);
    }

    function noteFreq(note, octave = 4) {
      const parsed = parseNote(note);
      if (!parsed) return null;

      const midi = (octave + 1) * 12 + parsed.semitone;
      return 440 * Math.pow(2, (midi - 69) / 12);
    }

    function playScaleDescending(notes, tempo = 180) {
      if (ctx.state === 'suspended') {
        ctx.resume();
      }

      const duration = 60 / tempo / 2;
      const reversed = [...notes].reverse();
      reversed.forEach((note, i) => {
        const freq = noteFreq(note.name, note.octave);
        if (!freq) return;

        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.frequency.value = freq;
        osc.type = 'sine';
        const startTime = ctx.currentTime + i * duration;
        const endTime = ctx.currentTime + (i + 1) * duration;
        gain.gain.setValueAtTime(0.1, startTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, endTime);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start(startTime);
        osc.stop(endTime);
      });
    }

    function getNoteAtFret(stringNote, fret) {
      const parsed = parseNote(stringNote);
      if (!parsed) return null;
      return chromaticScale[(parsed.semitone + fret) % 12];
    }

    function buildFretboard() {
      const fretboard = document.getElementById('fretboard');
      const markers = document.getElementById('fret-markers');
      fretboard.innerHTML = '';
      markers.innerHTML = '';

      const markerSpacer = document.createElement('div');
      markerSpacer.className = 'fret-marker';
      markers.appendChild(markerSpacer);

      for (let f = 0; f <= fretCount; f++) {
        const marker = document.createElement('div');
        marker.className = 'fret-marker';
        if ([3, 5, 7, 9, 12, 15].includes(f)) {
          marker.classList.add('marked');
          marker.textContent = f;
        }
        markers.appendChild(marker);
      }

      stringNotes.forEach((stringNote) => {
        const stringDiv = document.createElement('div');
        stringDiv.className = 'string';

        const label = document.createElement('div');
        label.className = 'string-label';
        label.textContent = stringNote;
        stringDiv.appendChild(label);

        for (let fret = 0; fret <= fretCount; fret++) {
          const fretDiv = document.createElement('div');
          fretDiv.className = 'fret';
          const note = getNoteAtFret(stringNote, fret);
          fretDiv.dataset.note = note;
          fretDiv.dataset.fret = fret;
          if (fret === 0) {
            fretDiv.dataset.openLabel = stringNote;
            fretDiv.textContent = stringNote;
          }
          stringDiv.appendChild(fretDiv);
        }

        fretboard.appendChild(stringDiv);
      });
    }

    function clearFretboard() {
      document.querySelectorAll('.fret').forEach((fret) => {
        fret.classList.remove('highlighted', 'root', 'sub', 'dom', 'alt');
        fret.textContent = fret.dataset.fret === '0' ? fret.dataset.openLabel || fret.dataset.note : '';
      });
      document.querySelectorAll('.bar').forEach((bar) => bar.classList.remove('active'));
      document.getElementById('fretboard-title').textContent = 'Select a chord to see the scale on the fretboard';
    }

    function showScaleOnFretboard(scaleName, notes, rootNote) {
      clearFretboard();

      const normalizedNotes = notes.map((n) => normalizeNote(n));
      const rootData = parseNote(rootNote);
      if (!rootData) return;
      const displayNameMap = new Map();
      notes.forEach((note) => {
        const key = normalizeNote(note);
        if (!displayNameMap.has(key)) {
          displayNameMap.set(key, note);
        }
      });

      const intervalFromRoot = (note) => {
        const parsed = parseNote(note);
        if (!parsed) return null;
        return (parsed.semitone - rootData.semitone + 12) % 12;
      };

      const intervalMap = {
        0: 'I',
        1: 'â™­II',
        2: 'II',
        3: 'â™­III',
        4: 'III',
        5: 'IV',
        6: 'â™¯IV',
        7: 'V',
        8: 'â™¯V',
        9: 'VI',
        10: 'â™­VII',
        11: 'VII',
      };

      const degreeFunctionColor = {
        I: 'root',
        II: 'subdominant',
        'â™­II': 'subdominant',
        IV: 'subdominant',
        'â™¯IV': 'subdominant',
        V: 'dominant',
        'â™­VII': 'dominant',
        VII: 'dominant',
        III: 'other',
        'â™­III': 'other',
        VI: 'other',
        'â™¯V': 'other',
        'â™­V': 'dominant',
        'â™­VI': 'other',
      };

      const functionClassMap = {
        root: 'root',
        subdominant: 'sub',
        dominant: 'dom',
        other: 'alt',
      };

      document.querySelectorAll('.fret').forEach((fret) => {
        const fretNote = normalizeNote(fret.dataset.note);
        if (!normalizedNotes.includes(fretNote)) return;

        const interval = intervalFromRoot(fretNote);
        if (interval === null) return;

        const displayNote = displayNameMap.get(fretNote) || fret.dataset.note || fretNote;
        const sanitizedDisplay = sanitizeAccidentals(displayNote);

        let degree = intervalMap[interval] || '?';
        if (interval === 6) {
          degree = sanitizedDisplay.includes('#') ? 'â™¯IV' : 'â™­V';
        } else if (interval === 8) {
          degree = sanitizedDisplay.includes('b') ? 'â™­VI' : 'â™¯V';
        }

        const func = degreeFunctionColor[degree] || 'other';
        const funcClass = functionClassMap[func];

        fret.classList.add('highlighted');
        if (degree === 'I') {
          fret.classList.add('root');
        } else if (funcClass) {
          fret.classList.add(funcClass);
        }

        fret.textContent = `${displayNote}\n(${degree})`;
      });

      document.getElementById('fretboard-title').textContent = scaleName;
    }

    const chartData = [
      { chord: 'Câ–³', roman: 'Iâ–³', scale: 'Major Bebop', notes: ['C', 'D', 'E', 'F', 'G', 'G#', 'A', 'B', 'C'], root: 'C' },
      { chord: 'BÃ¸ / E7', roman: 'viiÃ¸7 / III7', scale: 'Melodic Minor Bebop (E)', notes: ['E', 'F#', 'G', 'A', 'B', 'C', 'D', 'D#', 'E'], root: 'E' },
      { chord: 'Am7 / D7', roman: 'vi7 / II7', scale: 'Minor Bebop / Dominant Bebop', notes: ['A', 'B', 'C', 'C#', 'D', 'E', 'F#', 'G', 'A'], root: 'A' },
      { chord: 'Gm7 / C7', roman: 'v7 / I7', scale: 'Dorian Bebop / Dominant Bebop', notes: ['G', 'A', 'Bb', 'B', 'C', 'D', 'E', 'F', 'G'], root: 'G' },
      { chord: 'F7', roman: 'IV7', scale: 'Dominant Bebop', notes: ['F', 'G', 'A', 'Bb', 'C', 'D', 'Eb', 'E', 'F'], root: 'F' },
      { chord: 'Fm7 / Bb7', roman: 'iv7 / â™­VII7', scale: 'Minor Bebop / Dominant Bebop', notes: ['F', 'G', 'Ab', 'A', 'Bb', 'C', 'D', 'Eb', 'F'], root: 'F' },
      { chord: 'Em7 / A7', roman: 'iii7 / VI7', scale: 'Minor Bebop / Dominant Bebop', notes: ['E', 'F#', 'G', 'G#', 'A', 'B', 'C#', 'D', 'E'], root: 'E' },
      { chord: 'Ebm7 / Ab7', roman: 'â™­iii7 / â™­VI7', scale: 'Minor Bebop / Dominant Bebop', notes: ['Eb', 'F', 'Gb', 'G', 'Ab', 'Bb', 'C', 'Db', 'Eb'], root: 'Eb' },
      { chord: 'Dm7', roman: 'ii7', scale: 'Dorian Bebop', notes: ['D', 'E', 'F', 'F#', 'G', 'A', 'B', 'C', 'D'], root: 'D' },
      { chord: 'G7', roman: 'V7', scale: 'Dominant Bebop', notes: ['G', 'A', 'B', 'C', 'D', 'E', 'F', 'F#', 'G'], root: 'G' },
      { chord: 'Câ–³ / A7', roman: 'Iâ–³ / VI7', scale: 'Major Bebop / Dominant Bebop', notes: ['C', 'D', 'E', 'F', 'G', 'G#', 'A', 'B', 'C'], root: 'C' },
      { chord: 'Dm7 / G7', roman: 'ii7 / V7', scale: 'Minor Bebop / Dominant Bebop', notes: ['D', 'E', 'F', 'F#', 'G', 'A', 'B', 'C', 'D'], root: 'D' },
    ];

    const scaleLibrary = {
      'Bebop Scales': [
        { name: 'Major Bebop', notes: ['C', 'D', 'E', 'F', 'G', 'G#', 'A', 'B'], root: 'C' },
        { name: 'Dominant Bebop', notes: ['C', 'D', 'E', 'F', 'G', 'A', 'Bb', 'B'], root: 'C' },
        { name: 'Minor Bebop', notes: ['C', 'D', 'Eb', 'E', 'F', 'G', 'A', 'Bb'], root: 'C' },
        { name: 'Dorian Bebop', notes: ['C', 'D', 'Eb', 'E', 'F', 'G', 'A', 'Bb'], root: 'C' },
        { name: 'Harmonic Minor Bebop', notes: ['C', 'D', 'Eb', 'F', 'G', 'Ab', 'A', 'B'], root: 'C' },
      ],
      'Diatonic Modes': [
        { name: 'Ionian (Major)', notes: ['C', 'D', 'E', 'F', 'G', 'A', 'B'], root: 'C' },
        { name: 'Dorian', notes: ['C', 'D', 'Eb', 'F', 'G', 'A', 'Bb'], root: 'C' },
        { name: 'Phrygian', notes: ['C', 'Db', 'Eb', 'F', 'G', 'Ab', 'Bb'], root: 'C' },
        { name: 'Lydian', notes: ['C', 'D', 'E', 'F#', 'G', 'A', 'B'], root: 'C' },
        { name: 'Mixolydian', notes: ['C', 'D', 'E', 'F', 'G', 'A', 'Bb'], root: 'C' },
        { name: 'Aeolian (Natural Minor)', notes: ['C', 'D', 'Eb', 'F', 'G', 'Ab', 'Bb'], root: 'C' },
        { name: 'Locrian', notes: ['C', 'Db', 'Eb', 'F', 'Gb', 'Ab', 'Bb'], root: 'C' },
      ],
      'Harmonic Minor & Modes': [
        { name: 'Harmonic Minor', notes: ['C', 'D', 'Eb', 'F', 'G', 'Ab', 'B'], root: 'C' },
        { name: 'Locrian â™®6', notes: ['C', 'Db', 'Eb', 'F', 'Gb', 'A', 'Bb'], root: 'C' },
        { name: 'Ionian #5', notes: ['C', 'D', 'E', 'F', 'G#', 'A', 'B'], root: 'C' },
        { name: 'Dorian #4', notes: ['C', 'D', 'Eb', 'F#', 'G', 'A', 'Bb'], root: 'C' },
        { name: 'Phrygian Dominant', notes: ['C', 'Db', 'E', 'F', 'G', 'Ab', 'Bb'], root: 'C' },
        { name: 'Lydian #2', notes: ['C', 'D#', 'E', 'F#', 'G', 'A', 'B'], root: 'C' },
        { name: 'Altered Diminished (Superlocrian bb7)', notes: ['C', 'Db', 'Eb', 'Fb', 'Gb', 'Ab', 'Bbb'], root: 'C' },
      ],
      'Altered & Jazz Scales': [
        { name: 'Altered Scale (Superlocrian)', notes: ['C', 'Db', 'Eb', 'Fb', 'Gb', 'Ab', 'Bb'], root: 'C' },
        { name: 'Whole Tone', notes: ['C', 'D', 'E', 'F#', 'G#', 'A#'], root: 'C' },
        { name: 'Diminished (Half-Whole)', notes: ['C', 'Db', 'Eb', 'E', 'F#', 'G', 'A', 'Bb'], root: 'C' },
        { name: 'Diminished (Whole-Half)', notes: ['C', 'D', 'Eb', 'F', 'Gb', 'Ab', 'A', 'B'], root: 'C' },
        { name: 'Lydian Dominant', notes: ['C', 'D', 'E', 'F#', 'G', 'A', 'Bb'], root: 'C' },
        { name: 'Melodic Minor', notes: ['C', 'D', 'Eb', 'F', 'G', 'A', 'B'], root: 'C' },
      ],
    };

    const chartContainer = document.getElementById('chart');
    const libraryContainer = document.getElementById('scale-library');

    chartData.forEach((bar, idx) => {
      const div = document.createElement('div');
      div.className = 'bar';
      div.dataset.index = idx;

      const chord = document.createElement('div');
      chord.className = 'chord';
      chord.textContent = bar.chord;

      const roman = document.createElement('div');
      roman.className = 'roman';
      roman.textContent = bar.roman;

      const scale = document.createElement('div');
      scale.className = 'scale';
      scale.textContent = bar.scale;

      const notes = document.createElement('div');
      notes.className = 'notes';
      notes.textContent = 'â†“ ' + [...bar.notes].reverse().join(' - ');

      div.append(chord, roman, scale, notes);

      div.addEventListener('click', () => {
        const noteObjs = bar.notes.map((name) => ({
          name: sanitizeAccidentals(name),
          octave: 4,
        }));
        playScaleDescending(noteObjs);
        showScaleOnFretboard(`${bar.chord} - ${bar.scale}`, bar.notes, bar.root);
        document.querySelectorAll('.bar').forEach((b) => b.classList.remove('active'));
        div.classList.add('active');
      });

      chartContainer.appendChild(div);
    });

    Object.entries(scaleLibrary).forEach(([category, scales]) => {
      const categoryDiv = document.createElement('div');
      categoryDiv.className = 'scale-category';

      const title = document.createElement('div');
      title.className = 'category-title';
      title.textContent = category;
      categoryDiv.appendChild(title);

      scales.forEach((scale) => {
        const item = document.createElement('div');
        item.className = 'scale-item';

        const name = document.createElement('div');
        name.className = 'scale-name';
        name.textContent = scale.name;

        const notes = document.createElement('div');
        notes.className = 'scale-notes';
        notes.textContent = scale.notes.join(' - ');

        item.append(name, notes);

        item.addEventListener('click', () => {
          showScaleOnFretboard(scale.name, scale.notes, scale.root);
          const noteObjs = scale.notes.map((name) => ({
            name: sanitizeAccidentals(name),
            octave: 4,
          }));
          playScaleDescending([...noteObjs, noteObjs[0]]);
        });

        categoryDiv.appendChild(item);
      });

      libraryContainer.appendChild(categoryDiv);
    });

    document.getElementById('clearFretboardBtn').addEventListener('click', clearFretboard);

    buildFretboard();
  </script>
</body>
</html>
